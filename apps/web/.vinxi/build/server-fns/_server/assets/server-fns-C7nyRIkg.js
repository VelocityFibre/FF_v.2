import{fromJSON as O,crossSerializeStream as te,getCrossReferenceHeader as se}from"seroval";import{CustomEventPlugin as R,DOMExceptionPlugin as x,EventPlugin as v,FormDataPlugin as S,HeadersPlugin as C,ReadableStreamPlugin as P,RequestPlugin as A,ResponsePlugin as q,URLSearchParamsPlugin as H,URLPlugin as T}from"seroval-plugins/web";import{lazy as re,createComponent as oe,sharedConfig as X}from"solid-js";import{ssrElement as g,escape as ne,mergeProps as ie,ssr as ae,getRequestEvent as pe,isServer as ce,renderToString as ue}from"solid-js/web";import{provideRequestEvent as D}from"solid-js/web/storage";import{H3Event as j,setHeader as le,appendResponseHeader as de,getRequestIP as me,parseCookies as fe,getResponseStatus as he,getResponseStatusText as ge,getCookie as be,setCookie as ye,getResponseHeader as ke,setResponseHeader as $e,removeResponseHeader as we,getResponseHeaders as Fe,getRequestURL as Re,getRequestWebStream as xe,setResponseStatus as ve,eventHandler as Se}from"h3";import{getContext as Ce}from"unctx";import{AsyncLocalStorage as Pe}from"node:async_hooks";import{createRouter as Ae}from"radix3";function qe(e){let s;const t=J(e),o={duplex:"half",method:e.method,headers:e.headers};return e.node.req.body instanceof ArrayBuffer?new Request(t,{...o,body:e.node.req.body}):new Request(t,{...o,get body(){return s||(s=_e(e),s)}})}function He(e){return e.web??={request:qe(e),url:J(e)},e.web.request}function Te(){return Be()}const z=Symbol("$HTTPEvent");function je(e){return typeof e=="object"&&(e instanceof j||e?.[z]instanceof j||e?.__is_event__===!0)}function c(e){return function(...s){let t=s[0];if(je(t))s[0]=t instanceof j||t.__is_event__?t:t[z];else{if(!globalThis.app.config.server.experimental?.asyncContext)throw new Error("AsyncLocalStorage was not enabled. Use the `server.experimental.asyncContext: true` option in your app configuration to enable it. Or, pass the instance of HTTPEvent that you have as the first argument to the function.");if(t=Te(),!t)throw new Error("No HTTPEvent found in AsyncLocalStorage. Make sure you are using the function within the server runtime.");s.unshift(t)}return e(...s)}}const J=c(Re),Ee=c(me),k=c(ve),I=c(he),Ve=c(ge),b=c(Fe),U=c(ke),Le=c($e),G=c(de),Oe=c(fe),Ie=c(be),Ue=c(ye),y=c(le),_e=c(xe),Me=c(we),We=c(He);function Ne(){return Ce("nitro-app",{asyncContext:!!globalThis.app.config.server.experimental?.asyncContext,AsyncLocalStorage:Pe})}function Be(){return Ne().use().event}const $="Invariant Violation",{setPrototypeOf:Xe=function(e,s){return e.__proto__=s,e}}=Object;class E extends Error{framesToPop=1;name=$;constructor(s=$){super(typeof s=="number"?`${$}: ${s} (see https://github.com/apollographql/invariant-packages)`:s),Xe(this,E.prototype)}}function De(e,s){if(!e)throw new E(s)}const w="solidFetchEvent";function ze(e){return{request:We(e),response:Qe(e),clientAddress:Ee(e),locals:{},nativeEvent:e}}function Je(e){return{...e}}function Ge(e){if(!e.context[w]){const s=ze(e);e.context[w]=s}return e.context[w]}function _(e,s){for(const[t,o]of s.entries())G(e,t,o)}class Ke{event;constructor(s){this.event=s}get(s){const t=U(this.event,s);return Array.isArray(t)?t.join(", "):t||null}has(s){return this.get(s)!==void 0}set(s,t){return Le(this.event,s,t)}delete(s){return Me(this.event,s)}append(s,t){G(this.event,s,t)}getSetCookie(){const s=U(this.event,"Set-Cookie");return Array.isArray(s)?s:[s]}forEach(s){return Object.entries(b(this.event)).forEach(([t,o])=>s(Array.isArray(o)?o.join(", "):o,t,this))}entries(){return Object.entries(b(this.event)).map(([s,t])=>[s,Array.isArray(t)?t.join(", "):t])[Symbol.iterator]()}keys(){return Object.keys(b(this.event))[Symbol.iterator]()}values(){return Object.values(b(this.event)).map(s=>Array.isArray(s)?s.join(", "):s)[Symbol.iterator]()}[Symbol.iterator](){return this.entries()[Symbol.iterator]()}}function Qe(e){return{get status(){return I(e)},set status(s){k(e,s)},get statusText(){return Ve(e)},set statusText(s){k(e,I(e),s)},headers:new Ke(e)}}const K=[{page:!0,$component:{src:"src/routes/dashboard.tsx?pick=default&pick=$css",build:()=>import("../dashboard.js"),import:()=>import("../dashboard.js")},path:"/dashboard",filePath:"/home/ldp/louisdup/Clients/VelocityFibre/App/FF v2/apps/web/src/routes/dashboard.tsx"},{page:!0,$component:{src:"src/routes/index.tsx?pick=default&pick=$css",build:()=>import("../index.js"),import:()=>import("../index.js")},path:"/",filePath:"/home/ldp/louisdup/Clients/VelocityFibre/App/FF v2/apps/web/src/routes/index.tsx"},{page:!0,$component:{src:"src/routes/reports.tsx?pick=default&pick=$css",build:()=>import("../reports.js"),import:()=>import("../reports.js")},path:"/reports",filePath:"/home/ldp/louisdup/Clients/VelocityFibre/App/FF v2/apps/web/src/routes/reports.tsx"},{page:!0,$component:{src:"src/routes/settings.tsx?pick=default&pick=$css",build:()=>import("../settings.js"),import:()=>import("../settings.js")},path:"/settings",filePath:"/home/ldp/louisdup/Clients/VelocityFibre/App/FF v2/apps/web/src/routes/settings.tsx"},{page:!0,$component:{src:"src/routes/team.tsx?pick=default&pick=$css",build:()=>import("../team.js"),import:()=>import("../team.js")},path:"/team",filePath:"/home/ldp/louisdup/Clients/VelocityFibre/App/FF v2/apps/web/src/routes/team.tsx"},{page:!0,$component:{src:"src/routes/theme-test.tsx?pick=default&pick=$css",build:()=>import("../theme-test.js"),import:()=>import("../theme-test.js")},path:"/theme-test",filePath:"/home/ldp/louisdup/Clients/VelocityFibre/App/FF v2/apps/web/src/routes/theme-test.tsx"},{page:!0,$component:{src:"src/routes/time-tracking.tsx?pick=default&pick=$css",build:()=>import("../time-tracking.js"),import:()=>import("../time-tracking.js")},path:"/time-tracking",filePath:"/home/ldp/louisdup/Clients/VelocityFibre/App/FF v2/apps/web/src/routes/time-tracking.tsx"},{page:!0,$component:{src:"src/routes/admin/index.tsx?pick=default&pick=$css",build:()=>import("../index2.js"),import:()=>import("../index2.js")},path:"/admin/",filePath:"/home/ldp/louisdup/Clients/VelocityFibre/App/FF v2/apps/web/src/routes/admin/index.tsx"},{page:!0,$component:{src:"src/routes/admin/reports.tsx?pick=default&pick=$css",build:()=>import("../reports2.js"),import:()=>import("../reports2.js")},path:"/admin/reports",filePath:"/home/ldp/louisdup/Clients/VelocityFibre/App/FF v2/apps/web/src/routes/admin/reports.tsx"},{page:!0,$component:{src:"src/routes/admin/role-switcher.tsx?pick=default&pick=$css",build:()=>import("../role-switcher.js"),import:()=>import("../role-switcher.js")},path:"/admin/role-switcher",filePath:"/home/ldp/louisdup/Clients/VelocityFibre/App/FF v2/apps/web/src/routes/admin/role-switcher.tsx"},{page:!0,$component:{src:"src/routes/admin/settings.tsx?pick=default&pick=$css",build:()=>import("../settings2.js"),import:()=>import("../settings2.js")},path:"/admin/settings",filePath:"/home/ldp/louisdup/Clients/VelocityFibre/App/FF v2/apps/web/src/routes/admin/settings.tsx"},{page:!0,$component:{src:"src/routes/admin/tasks.tsx?pick=default&pick=$css",build:()=>import("../tasks.js"),import:()=>import("../tasks.js")},path:"/admin/tasks",filePath:"/home/ldp/louisdup/Clients/VelocityFibre/App/FF v2/apps/web/src/routes/admin/tasks.tsx"},{page:!0,$component:{src:"src/routes/admin/users.tsx?pick=default&pick=$css",build:()=>import("../users.js"),import:()=>import("../users.js")},path:"/admin/users",filePath:"/home/ldp/louisdup/Clients/VelocityFibre/App/FF v2/apps/web/src/routes/admin/users.tsx"},{page:!0,$component:{src:"src/routes/projects/index.tsx?pick=default&pick=$css",build:()=>import("../index3.js"),import:()=>import("../index3.js")},path:"/projects/",filePath:"/home/ldp/louisdup/Clients/VelocityFibre/App/FF v2/apps/web/src/routes/projects/index.tsx"},{page:!0,$component:{src:"src/routes/reports/personal.tsx?pick=default&pick=$css",build:()=>import("../personal.js"),import:()=>import("../personal.js")},path:"/reports/personal",filePath:"/home/ldp/louisdup/Clients/VelocityFibre/App/FF v2/apps/web/src/routes/reports/personal.tsx"},{page:!0,$component:{src:"src/routes/tasks/my-tasks.tsx?pick=default&pick=$css",build:()=>import("../my-tasks.js"),import:()=>import("../my-tasks.js")},path:"/tasks/my-tasks",filePath:"/home/ldp/louisdup/Clients/VelocityFibre/App/FF v2/apps/web/src/routes/tasks/my-tasks.tsx"},{page:!0,$component:{src:"src/routes/tasks/project-tasks.tsx?pick=default&pick=$css",build:()=>import("../project-tasks.js"),import:()=>import("../project-tasks.js")},path:"/tasks/project-tasks",filePath:"/home/ldp/louisdup/Clients/VelocityFibre/App/FF v2/apps/web/src/routes/tasks/project-tasks.tsx"},{page:!0,$component:{src:"src/routes/tasks/team-tasks.tsx?pick=default&pick=$css",build:()=>import("../team-tasks.js"),import:()=>import("../team-tasks.js")},path:"/tasks/team-tasks",filePath:"/home/ldp/louisdup/Clients/VelocityFibre/App/FF v2/apps/web/src/routes/tasks/team-tasks.tsx"},{page:!0,$component:{src:"src/routes/admin/projects/[id].tsx?pick=default&pick=$css",build:()=>import("../_id_.js"),import:()=>import("../_id_.js")},path:"/admin/projects/:id",filePath:"/home/ldp/louisdup/Clients/VelocityFibre/App/FF v2/apps/web/src/routes/admin/projects/[id].tsx"},{page:!0,$component:{src:"src/routes/admin/projects/index.tsx?pick=default&pick=$css",build:()=>import("../index4.js"),import:()=>import("../index4.js")},path:"/admin/projects/",filePath:"/home/ldp/louisdup/Clients/VelocityFibre/App/FF v2/apps/web/src/routes/admin/projects/index.tsx"},{page:!0,$component:{src:"src/routes/projects/[id]/client-portal.tsx?pick=default&pick=$css",build:()=>import("../client-portal.js"),import:()=>import("../client-portal.js")},path:"/projects/:id/client-portal",filePath:"/home/ldp/louisdup/Clients/VelocityFibre/App/FF v2/apps/web/src/routes/projects/[id]/client-portal.tsx"},{page:!0,$component:{src:"src/routes/projects/[id]/index.tsx?pick=default&pick=$css",build:()=>import("../index5.js"),import:()=>import("../index5.js")},path:"/projects/:id/",filePath:"/home/ldp/louisdup/Clients/VelocityFibre/App/FF v2/apps/web/src/routes/projects/[id]/index.tsx"},{page:!0,$component:{src:"src/routes/projects/[id]/timeline.tsx?pick=default&pick=$css",build:()=>import("../timeline.js"),import:()=>import("../timeline.js")},path:"/projects/:id/timeline",filePath:"/home/ldp/louisdup/Clients/VelocityFibre/App/FF v2/apps/web/src/routes/projects/[id]/timeline.tsx"},{page:!0,$component:{src:"src/routes/projects/[id]/workflow.tsx?pick=default&pick=$css",build:()=>import("../workflow.js"),import:()=>import("../workflow.js")},path:"/projects/:id/workflow",filePath:"/home/ldp/louisdup/Clients/VelocityFibre/App/FF v2/apps/web/src/routes/projects/[id]/workflow.tsx"}],Ye=Ze(K.filter(e=>e.page));function Ze(e){function s(t,o,n,i){const a=Object.values(t).find(p=>n.startsWith(p.id+"/"));return a?(s(a.children||(a.children=[]),o,n.slice(a.id.length)),t):(t.push({...o,id:n,path:n.replace(/\([^)/]+\)/g,"").replace(/\/+/g,"/")}),t)}return e.sort((t,o)=>t.path.length-o.path.length).reduce((t,o)=>s(t,o,o.path,o.path),[])}function et(e){return e.$HEAD||e.$GET||e.$POST||e.$PUT||e.$PATCH||e.$DELETE}Ae({routes:K.reduce((e,s)=>{if(!et(s))return e;let t=s.path.replace(/\([^)/]+\)/g,"").replace(/\/+/g,"/").replace(/\*([^/]*)/g,(o,n)=>`**:${n}`).split("/").map(o=>o.startsWith(":")||o.startsWith("*")?o:encodeURIComponent(o)).join("/");if(/:[^/]*\?/g.test(t))throw new Error(`Optional parameters are not supported in API routes: ${t}`);if(e[t])throw new Error(`Duplicate API routes for "${t}" found at "${e[t].route.path}" and "${s.path}"`);return e[t]={route:s},e},{})});function tt(e){e.forEach(s=>{if(!s.attrs.href)return;let t=document.head.querySelector(`link[href="${s.attrs.href}"]`);t||(t=document.createElement("link"),t.setAttribute("rel","preload"),t.setAttribute("as","style"),t.setAttribute("href",s.attrs.href),document.head.appendChild(t))})}var st=" ";const rt={style:e=>g("style",e.attrs,()=>e.children,!0),link:e=>g("link",e.attrs,void 0,!0),script:e=>e.attrs.src?g("script",ie(()=>e.attrs,{get id(){return e.key}}),()=>ae(st),!0):null,noscript:e=>g("noscript",e.attrs,()=>ne(e.children),!0)};function ot(e,s){let{tag:t,attrs:{key:o,...n}={key:void 0},children:i}=e;return rt[t]({attrs:{...n,nonce:s},key:o,children:i})}function nt(e,s,t,o="default"){return re(async()=>{{const i=(await e.import())[o],p=(await s.inputs?.[e.src].assets()).filter(d=>d.tag==="style"||d.attrs.rel==="stylesheet");return typeof window<"u"&&tt(p),{default:d=>[...p.map(f=>ot(f)),oe(i,d)]}}})}function Q(){function e(t){return{...t,...t.$$route?t.$$route.require().route:void 0,info:{...t.$$route?t.$$route.require().route.info:{},filesystem:!0},component:t.$component&&nt(t.$component,globalThis.MANIFEST.client,globalThis.MANIFEST.ssr),children:t.children?t.children.map(e):void 0}}return Ye.map(e)}let M;const Rt=ce?()=>pe().routes:()=>M||(M=Q());function it(e){const s=Ie(e.nativeEvent,"flash");if(s)try{let t=JSON.parse(s);if(!t||!t.result)return;const o=[...t.input.slice(0,-1),new Map(t.input[t.input.length-1])],n=t.error?new Error(t.result):t.result;return{input:o,url:t.url,pending:!1,result:t.thrown?void 0:n,error:t.thrown?n:void 0}}catch(t){console.error(t)}finally{Ue(e.nativeEvent,"flash","",{maxAge:0})}}async function at(e){const s=globalThis.MANIFEST.client;return globalThis.MANIFEST.ssr,e.response.headers.set("Content-Type","text/html"),Object.assign(e,{manifest:await s.json(),assets:[...await s.inputs[s.handler].assets()],router:{submission:it(e)},routes:Q(),complete:!1,$islands:new Set})}const pt=new Set([301,302,303,307,308]);function ct(e){return e.status&&pt.has(e.status)?e.status:302}const ut={};function lt(e){const s=new TextEncoder().encode(e),t=s.length,o=t.toString(16),n="00000000".substring(0,8-o.length)+o,i=new TextEncoder().encode(`;0x${n};`),a=new Uint8Array(12+t);return a.set(i),a.set(s,12),a}function W(e,s){return new ReadableStream({start(t){te(s,{scopeId:e,plugins:[R,x,v,S,C,P,A,q,H,T],onSerialize(o,n){t.enqueue(lt(n?`(${se(e)},${o})`:o))},onDone(){t.close()},onError(o){t.error(o)}})}})}async function dt(e){const s=Ge(e),t=s.request,o=t.headers.get("X-Server-Id"),n=t.headers.get("X-Server-Instance"),i=t.headers.has("X-Single-Flight"),a=new URL(t.url);let p,l;if(o)De(typeof o=="string","Invalid server function"),[p,l]=o.split("#");else if(p=a.searchParams.get("id"),l=a.searchParams.get("name"),!p||!l)return new Response(null,{status:404});const d=ut[p];let f;if(!d)return new Response(null,{status:404});f=await d.importer();const Y=f[d.functionName];let m=[];if(!n||e.method==="GET"){const r=a.searchParams.get("args");if(r){const u=JSON.parse(r);(u.t?O(u,{plugins:[R,x,v,S,C,P,A,q,H,T]}):u).forEach(h=>m.push(h))}}if(e.method==="POST"){const r=t.headers.get("content-type"),u=e.node.req,h=u instanceof ReadableStream,Z=u.body instanceof ReadableStream,V=h&&u.locked||Z&&u.body.locked,L=h?u:u.body;if(r?.startsWith("multipart/form-data")||r?.startsWith("application/x-www-form-urlencoded"))m.push(await(V?t:new Request(t,{...t,body:L})).formData());else if(r?.startsWith("application/json")){const ee=V?t:new Request(t,{...t,body:L});m=O(await ee.json(),{plugins:[R,x,v,S,C,P,A,q,H,T]})}}try{let r=await D(s,async()=>(X.context={event:s},s.locals.serverFunctionMeta={id:p+"#"+l},Y(...m)));if(i&&n&&(r=await B(s,r)),r instanceof Response){if(r.headers&&r.headers.has("X-Content-Raw"))return r;n&&(r.headers&&_(e,r.headers),r.status&&(r.status<300||r.status>=400)&&k(e,r.status),r.customBody?r=await r.customBody():r.body==null&&(r=null))}return n?(y(e,"content-type","text/javascript"),W(n,r)):N(r,t,m)}catch(r){if(r instanceof Response)i&&n&&(r=await B(s,r)),r.headers&&_(e,r.headers),r.status&&(!n||r.status<300||r.status>=400)&&k(e,r.status),r.customBody?r=r.customBody():r.body==null&&(r=null),y(e,"X-Error","true");else if(n){const u=r instanceof Error?r.message:typeof r=="string"?r:"true";y(e,"X-Error",u.replace(/[\r\n]+/g,""))}else r=N(r,t,m,!0);return n?(y(e,"content-type","text/javascript"),W(n,r)):r}}function N(e,s,t,o){const n=new URL(s.url),i=e instanceof Error;let a=302,p;return e instanceof Response?(p=new Headers(e.headers),e.headers.has("Location")&&(p.set("Location",new URL(e.headers.get("Location"),n.origin+"").toString()),a=ct(e))):p=new Headers({Location:new URL(s.headers.get("referer")).toString()}),e&&p.append("Set-Cookie",`flash=${encodeURIComponent(JSON.stringify({url:n.pathname+n.search,result:i?e.message:e,thrown:o,error:i,input:[...t.slice(0,-1),[...t[t.length-1].entries()]]}))}; Secure; HttpOnly;`),new Response(null,{status:a,headers:p})}let F;function mt(e){const s=new Headers(e.request.headers),t=Oe(e.nativeEvent),o=e.response.headers.getSetCookie();s.delete("cookie");let n=!1;return e.nativeEvent.node?.req&&(n=!0,e.nativeEvent.node.req.headers.cookie=""),o.forEach(i=>{if(!i)return;const a=i.split(";")[0],[p,l]=a.split("=");p&&l&&(t[p]=l)}),Object.entries(t).forEach(([i,a])=>{s.append("cookie",`${i}=${a}`),n&&(e.nativeEvent.node.req.headers.cookie+=`${i}=${a};`)}),s}async function B(e,s){let t,o=new URL(e.request.headers.get("referer")).toString();s instanceof Response&&(s.headers.has("X-Revalidate")&&(t=s.headers.get("X-Revalidate").split(",")),s.headers.has("Location")&&(o=new URL(s.headers.get("Location"),new URL(e.request.url).origin+"").toString()));const n=Je(e);return n.request=new Request(o,{headers:mt(e)}),await D(n,async()=>{await at(n),F||(F=(await import("./app-DrxKUH8-.js")).default),n.router.dataOnly=t||!0,n.router.previousUrl=e.request.headers.get("referer");try{ue(()=>{X.context.event=n,F()})}catch(p){console.log(p)}const i=n.router.data;if(!i)return s;let a=!1;for(const p in i)i[p]===void 0?delete i[p]:a=!0;return a&&(s instanceof Response?s.customBody&&(i._$value=s.customBody()):(i._$value=s,s=new Response(null,{status:200})),s.customBody=()=>i,s.headers.set("X-Single-Flight","true")),s})}const xt=Se(dt);export{Rt as F,xt as h};
